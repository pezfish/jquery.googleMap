/**
* jQuery Google Map Helper
* Copyright (c) 2012 Kevin Doyle & Jonathan Hopkins
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
**/

(function(b){b.fn.googleMap=function(g){g=b.extend({mapType:"roadmap"},g);return this.each(function(){var m=b(this)[0],c,e,h,l,f,k;switch(g.mapType){case "roadmap":c=google.maps.MapTypeId.ROADMAP;break;case "satellite":c=google.maps.MapTypeId.SATELLITE;break;case "hybrid":c=google.maps.MapTypeId.HYBRID;break;case "terrain":c=google.maps.MapTypeId.TERRAIN}c={zoom:8,maxZoom:15,center:new google.maps.LatLng(0,0),mapTypeId:c};e=new google.maps.Map(m,c);k=new google.maps.InfoWindow;b.ajax({type:"GET",
dataType:"json",url:"data.json",success:function(a){for(i=0;i<a.sets.length;i++){var c=a.sets[i];h=new google.maps.LatLngBounds;for(j=0;j<c.points.length;j++){var d=c.points[j];l=new google.maps.LatLng(d.latlng[0],d.latlng[1]);f=new google.maps.Marker({map:e,position:l,icon:null});d.marker=f;google.maps.event.addListener(f,"click",function(b,a){return function(){k.setContent(c.points[a].content);k.open(e,b)}}(f,j));h.extend(f.getPosition())}c.bounds=h}d="";if(null!==a.initialset){for(i=0;i<a.sets.length;i++)a.sets[i].setid===
a.initialset&&(d=a.sets[i]);""==d&&(d=a.sets[0])}else d=a.sets[0];e.fitBounds(d.bounds);b(".goto").removeClass("current");b('a.goto[data-id="'+d.setid+'"]').addClass("current");b(".goto").click(function(){curid=b(this).data("id");for(i=0;i<a.sets.length;i++)a.sets[i].setid===curid&&(e.fitBounds(a.sets[i].bounds),e.setZoom(Math.min(e.getZoom(),15)),b(".goto").removeClass("current"),b(this).addClass("current"));return!1});b(".toggle").click(function(){curid=b(this).data("id");for(i=0;i<a.sets.length;i++)if(a.sets[i].setid===
curid)for(j=0;j<a.sets[i].points.length;j++)curmarker=a.sets[i].points[j].marker,curmarker.getVisible()?(curmarker.setVisible(!1),b('a.toggle[data-id="'+curid+'"]').addClass("invisible")):(curmarker.setVisible(!0),b('a.toggle[data-id="'+curid+'"]').removeClass("invisible"));return!1});b("#mapaddressform").submit(function(){(new google.maps.Geocoder).geocode({address:b("#mapaddress").val()},function(b,a){a===google.maps.GeocoderStatus.OK?(e.setCenter(b[0].geometry.location),e.setZoom(14)):a===google.maps.GeocoderStatus.ZERO_RESULTS&&
g.onGeocodeError.call(this)});return!1})}})})}})(jQuery);