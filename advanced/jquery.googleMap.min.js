/**
* jQuery Google Map Helper
* Copyright (c) 2012 Kevin Doyle & Jonathan Hopkins
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
**/

(function(a){a.fn.googleMap=function(g){g=a.extend({mapType:"roadmap"},g);return this.each(function(){var m=a(this)[0],c,e,h,l,f,k;switch(g.mapType){case "roadmap":c=google.maps.MapTypeId.ROADMAP;break;case "satellite":c=google.maps.MapTypeId.SATELLITE;break;case "hybrid":c=google.maps.MapTypeId.HYBRID;break;case "terrain":c=google.maps.MapTypeId.TERRAIN}c={zoom:8,maxZoom:15,center:new google.maps.LatLng(0,0),mapTypeId:c};e=new google.maps.Map(m,c);k=new google.maps.InfoWindow;a.ajax({type:"GET",dataType:"json",url:"data.json",success:function(b){for(i=0;i<b.sets.length;i++){var d=b.sets[i];h=new google.maps.LatLngBounds;for(j=0;j<d.points.length;j++){var c=d.points[j];l=new google.maps.LatLng(c.latlng[0],c.latlng[1]);f=new google.maps.Marker({map:e,position:l,icon:null});c.marker=f;google.maps.event.addListener(f,"click",function(a,c,d){return function(){k.setContent(b.sets[d].points[c].content);k.open(e,a)}}(f,j,i));h.extend(f.getPosition())}d.bounds=h}d="";if(null!==b.initialset){for(i=0;i<b.sets.length;i++)b.sets[i].setid===b.initialset&&(d=b.sets[i]);""==d&&(d=b.sets[0])}else d=b.sets[0];e.fitBounds(d.bounds);a(".goto").removeClass("current");a('a.goto[data-id="'+d.setid+'"]').addClass("current");a(".goto").click(function(){curid=a(this).data("id");for(i=0;i<b.sets.length;i++)b.sets[i].setid===curid&&(e.fitBounds(b.sets[i].bounds),e.setZoom(Math.min(e.getZoom(),15)),a(".goto").removeClass("current"),a(this).addClass("current"));return!1});a(".toggle").click(function(){curid=a(this).data("id");for(i=0;i<b.sets.length;i++)if(b.sets[i].setid===curid)for(j=0;j<b.sets[i].points.length;j++)curmarker=b.sets[i].points[j].marker,curmarker.getVisible()?(curmarker.setVisible(!1),a('a.toggle[data-id="'+curid+'"]').addClass("invisible")):(curmarker.setVisible(!0),a('a.toggle[data-id="'+curid+'"]').removeClass("invisible"));return!1});a("#mapaddressform").submit(function(){(new google.maps.Geocoder).geocode({address:a("#mapaddress").val()},function(a,b){b===google.maps.GeocoderStatus.OK?(e.setCenter(a[0].geometry.location),e.setZoom(14)):b===google.maps.GeocoderStatus.ZERO_RESULTS&&g.onGeocodeError.call(this)});return!1})}})})}})(jQuery);